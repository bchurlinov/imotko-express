enum UserRole {
  CLIENT
  AGENCY
  ADMIN
}

enum UserLanguage {
  EN
  MK
  AL
  SQ
}

enum NotificationStatus {
  READ
  UNREAD
}

model Admin {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
  id                     String               @id @default(cuid())
  name                   String
  lastName               String?
  email                  String               @unique
  location               String?
  emailVerified          DateTime?
  image                  String?
  hashedPassword         String?
  phone                  String?
  accessToken            String?
  refreshToken           String?
  language               UserLanguage?        @default(MK)
  role                   UserRole             @default(CLIENT)
  account                Account?
  clientId               String?
  client                 Client?
  notifications          Notification[]
  agencyId               String?
  agency                 Agency?              @relation(fields: [agencyId], references: [id])
  adminId                String?
  admin                  Admin?
  ipAddress              String?
  UserFeatureRequest     UserFeatureRequest[]
  //
  agencyMember           AgencyMember?        @relation("AgencyMember")
  ownedAgency            Agency?              @relation("AgencyOwner")
  //
  agencyInvitationSender AgencyInvitation[]   @relation("InvitingSender")
  createdAt              DateTime?            @default(now()) @db.Timestamptz(3)
  updatedAt              DateTime?            @updatedAt @db.Timestamptz(3)

  @@index([agencyId])
  @@index([clientId])
}

model Account {
  id                String  @id @default(cuid())
  userId            String  @unique
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Notification {
  id          String             @id @default(cuid())
  title       String
  description String
  status      NotificationStatus @default(UNREAD)
  recipientId String
  recipient   User               @relation(fields: [recipientId], references: [id], onDelete: Cascade)
  createdAt   DateTime           @default(now())
  readAt      DateTime?
  metadata    Json?
}

model UserFeatureRequest {
  id          String    @id @default(cuid())
  featureName String
  userId      String?
  user        User?     @relation(fields: [userId], references: [id])
  createdAt   DateTime? @default(now()) @db.Timestamptz(3)
  updatedAt   DateTime? @updatedAt @db.Timestamptz(3)

  @@index([userId])
}

model PasswordResetToken {
  id      String   @id @default(cuid())
  email   String   @unique
  userId  String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
}

model VerificationToken {
  id      String   @id @default(cuid())
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
}
